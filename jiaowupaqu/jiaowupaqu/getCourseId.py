import requests
from requests.exceptions import RequestException
import pickle
import re
import interact_db as db

def get_one_page(url):
  cookies = None
  with open('cookies','rb') as file:
    cookies = pickle.load(file)
  try:
    response = requests.get(url, cookies=cookies)
    if response.status_code == 200:
      return response.text
    return None
  except RequestException: 
    return None

def parse_one_page(html):
  pattern = re.compile('请选择专业@\(\(请选择@\*\*(.*?)%', re.S)
  items = re.findall(pattern, '请选择院系@{{请选择专业@((请选择@||01_文学院{{请选择专业@((请选择@**010%中国语言文学类((请选择@^**011%汉语言文学((请选择@^**012%汉语言文学(作家班)((请选择@^**015%戏剧影视文学((请选择@^**01A%中文基地((请选择@^||02_历史学院{{请选择专业@((请选择@**020%历史学类((请选择@^**021%历史学((请选择@^**022%考古学((请选择@^**023%考古学（文物鉴定方向）((请选择@^**02A%历史基地((请选择@^||03_法学院{{请选择专业@((请选择@**030%法学类((请选择@^**031%法学((请选择@^**032%法学（第二学位）((请选择@^**035%法学（运动员班）((请选择@^||04_哲学系{{请选择专业@((请选择@**040%哲学类((请选择@^**041%哲学((请选择@^**04A%哲学基地((请选择@^||05_新闻传播学院{{请选择专业@((请选择@**050%新闻传播学类((请选择@^**051%新闻学((请选择@^**052%广告学((请选择@^**053%广播电视新闻学((请选择@^**054%新闻学（记者班）((请选择@^**055%新闻学（运动员班）((请选择@^**056%广播电视学((请选择@^**057%新闻学（传媒实验班）((请选择@^||06_政府管理学院{{请选择专业@((请选择@**060%公共管理类((请选择@^**061%政治学与行政学((请选择@^**062%行政管理((请选择@^**063%国际政治((请选择@^**064%政治学((请选择@^**065%行政管理（劳动与社会保障方向）((请选择@^**066%教育技术学((请选择@^**067%劳动与社会保障((请选择@^**068%行政管理（运动员班）((请选择@^**069%行政管理（新疆班）((请选择@^**06A%政治学类((请选择@^||07_信息管理学院{{请选择专业@((请选择@**070%文科类((请选择@^**071%信息管理与信息系统((请选择@^**072%图书馆学((请选择@^**073%档案学((请选择@^**075%编辑出版学((请选择@^**077%理科类((请选择@^**078%档案学（第二学士学位）((请选择@^||08_社会学院{{请选择专业@((请选择@**080%社会学类((请选择@^**081%社会学((请选择@^**082%社会工作((请选择@^**084%应用心理学((请选择@^||09_商学院{{请选择专业@((请选择@**090%经济学类((请选择@^**091%经济学((请选择@^**092%国际经济与贸易((请选择@^**093%工商管理((请选择@^**094%会计学((请选择@^**095%财务管理((请选择@^**096%金融学((请选择@^**097%电子商务((请选择@^**098%市场营销((请选择@^**099%工商管理类((请选择@^**09A%工商管理（二学位)((请选择@^**09B%国际经济与贸易（二学位）((请选择@^**09C%工商管理（人力资源管理方向）((请选择@^**09D%保险学((请选择@^**09E%金融工程((请选择@^**09F%经济学（产业经济方向）((请选择@^**09G%保险((请选择@^||10_外国语学院{{请选择专业@((请选择@**100%外语类((请选择@^**101%英语((请选择@^**102%俄语((请选择@^**103%日语((请选择@^**104%法语((请选择@^**105%德语((请选择@^**106%西班牙语((请选择@^**107%英语(国际商务方向)((请选择@^**108%应用英语强化班((请选择@^**109%朝鲜语((请选择@^||11_数学系{{请选择专业@((请选择@**110%数学类((请选择@^**111%数学与应用数学((请选择@^**112%信息与计算科学((请选择@^**113%统计学((请选择@^**114%应用模块((请选择@^**115%应用模块（计算方向）((请选择@^**116%应用模块（统计方向）((请选择@^**117%统计学（专业学术及交叉复合模式）((请选择@^**118%统计学（就业创业模式）((请选择@^**119%信息与计算科学（专业学术及交叉复合模式）((请选择@^**11A%信息与计算科学（就业创业模式）((请选择@^**11B%数学（英才计划）((请选择@^||12_物理学院{{请选择专业@((请选择@**120%物理学类((请选择@^**121%物理学((请选择@^**122%应用物理学((请选择@^**123%声学((请选择@^**12A%物理基地((请选择@^**12B%物理学（英才计划）((请选择@^**12C%物理学（英才计划-匡院计划）((请选择@^||13_化学化工学院{{请选择专业@((请选择@**130%化学类((请选择@^**131%化学((请选择@^**132%应用化学((请选择@^**13A%化学(基地)((请选择@^**13B%化学（英才计划）((请选择@^**13C%化学（化学生物学）((请选择@^||14_生命科学学院{{请选择专业@((请选择@**140%生物科学类((请选择@^**141%生物技术((请选择@^**142%生物科学((请选择@^**143%生态学((请选择@^**149%生物技术（与药科大学联办）((请选择@^**14A%生物科学（基地）((请选择@^**14B%生物科学（英才计划）((请选择@^||15_地球科学与工程学院{{请选择专业@((请选择@**150%地质学类((请选择@^**151%地质学((请选择@^**151A%地质学（2+2）((请选择@^**152%地球化学((请选择@^**152A%地球化学（2+2）((请选择@^**153%地质工程((请选择@^**153A%地质工程（2+2）((请选择@^**154%水文与水资源工程((请选择@^**154A%水文与水资源工程（2+2）((请选择@^**155%信息资源与计算机管理((请选择@^**156%矿物岩石矿床((请选择@^**157%地质学（古生物学方向）((请选择@^**158%地下水科学与工程((请选择@^**158A%地下水科学与工程（2+2）((请选择@^**159%数字媒体技术((请选择@^**15A%地科基地((请选择@^**15B%地质学（地球物理学方向）((请选择@^**15BA%地质学（地球物理学方向）（2+2）((请选择@^**15C%理科试验班（地球系统科学与环境）((请选择@^**15D%地质学（生物演化与环境方向）((请选择@^**15DA%地质学（生物演化与环境方向）（2+2）((请选择@^**15E%地球物理学((请选择@^||16_地理与海洋科学学院{{请选择专业@((请选择@**160%地理科学类((请选择@^**161%资源环境与城乡规划管理((请选择@^**162%地理信息系统((请选择@^**162A%地理信息科学（2+2）((请选择@^**163%人文地理与城乡规划((请选择@^**163A%人文地理与城乡规划（2+2）((请选择@^**164%地理科学((请选择@^**164A%地理科学（2+2）((请选择@^**165%城市与资源学((请选择@^**166%旅游管理((请选择@^**167%海洋科学((请选择@^**167A%海洋科学（2+2）((请选择@^**168%地理信息科学((请选择@^**169%自然地理与资源环境((请选择@^**169A%自然地理与资源环境（2+2）((请选择@^**16A%地理基地((请选择@^**16B%海洋基地((请选择@^**16C%理科试验班（地球系统科学与环境）((请选择@^||17_大气科学学院{{请选择专业@((请选择@**170%大气科学类((请选择@^**171%大气科学((请选择@^**172%应用气象学((请选择@^**173%大气科学（2+2）((请选择@^**17A%大气科学（基地）((请选择@^**17B%应用气象学（基地）((请选择@^**17C%理科试验班（地球系统科学与环境）((请选择@^||18_电子科学与工程学院{{请选择专业@((请选择@**180%电子信息类((请选择@^**181%电子信息科学与技术((请选择@^**182%声学((请选择@^**184%通信工程((请选择@^**186%生物医学工程((请选择@^**187%微电子学((请选择@^**187A%微电子科学与工程((请选择@^**189%微电子科学与工程（集成电路设计与集成系统）((请选择@^||19_现代工程与应用科学学院{{请选择专业@((请选择@**190%材料类((请选择@^**191%材料物理((请选择@^**192%材料化学((请选择@^**193%光电信息科学与工程((请选择@^**194%新能源科学与工程((请选择@^**195%生物医学工程((请选择@^**196%光电信息工程((请选择@^**197%信息工程((请选择@^||20_环境学院{{请选择专业@((请选择@**200%环境科学与工程类((请选择@^**201%环境工程((请选择@^**202%环境科学((请选择@^**203%环境科学（环化）((请选择@^**204%环境科学（环生）((请选择@^**205%环境科学（环规）((请选择@^**206%环境工程（2+2）((请选择@^**207%环境科学（环化）（2+2）((请选择@^**208%环境科学（环生）（2+2）((请选择@^**209%环境科学（环规）（2+2）((请选择@^||21_天文与空间科学学院{{请选择专业@((请选择@**210%天文学类((请选择@^**211%天文学((请选择@^**212%空间科学与技术((请选择@^**21A%天文基地((请选择@^**21B%天文学（英才计划）((请选择@^||22_计算机科学与技术系{{请选择专业@((请选择@**220%计算机科学类((请选择@^**221%计算机科学与技术((请选择@^**223%计算机（计算机与金融工程方向）((请选择@^**224%计算机（计算机科学方向）((请选择@^**225%计算机（计算机系统方向）((请选择@^**226%计算机（计算机应用方向）((请选择@^**227%计算机（软件工程方向）((请选择@^**228%计算机（信息安全方向）((请选择@^**229%计算机（计算机金融方向）((请选择@^**22B%计算机（英才计划）((请选择@^||23_医学院{{请选择专业@((请选择@**230%医学类((请选择@^**230A%医学类（5+3）((请选择@^**231%临床医学((请选择@^**231A%临床医学（八年制）((请选择@^**231B%临床医学（5+3）((请选择@^**232%口腔医学((请选择@^**232A%口腔医学（5+3）((请选择@^**233%临床医学（军总）((请选择@^**234%基础医学((请选择@^||24_匡亚明学院{{请选择专业@((请选择@**241%应用文科强化班((请选择@^**242%理科强化班((请选择@^**243%理强（数理方向）((请选择@^**244%理强（生物化学）((请选择@^**245%英才计划（物理班）((请选择@^**246%英才计划（天文）((请选择@^**247%理强（大气基地）((请选择@^**248%英才计划（化学班）((请选择@^**249%英才计划（生命科学班）((请选择@^**24A%理强（地科基地）((请选择@^**24B%理强（地理基地）((请选择@^**24C%理强（海洋基地）((请选择@^**24D%理强（建筑基地）((请选择@^**24E%理强（教育基地）((请选择@^**24F%文强（中文基地）((请选择@^**24G%文强（历史基地）((请选择@^**24H%文强（哲学基地）((请选择@^**24I%英才计划（大理科班）((请选择@^**24J%英才计划（计算机班）((请选择@^**24K%英才计划（数学班）((请选择@^**24L%文强（经济学）((请选择@^**24M%文强（金融学）((请选择@^**24N%文强（国际经济与贸易）((请选择@^**24O%文强（工商管理）((请选择@^**24P%文强（会计学）((请选择@^**24Q%文强（电子商务）((请选择@^**24R%文强（新闻学）((请选择@^**24S%文强（法学）((请选择@^**24T%理强（统计学）((请选择@^**24U%理强（生物物理）((请选择@^**24V%理强（物理）((请选择@^**24W%理强（化学）((请选择@^**24X%文强（广告学）((请选择@^**24Y%文强（广播电视）((请选择@^**24Z%理强（数学与应用数学）((请选择@^**24a%理强（天文学）((请选择@^**24b%理强（计算机科学）((请选择@^**24c%理强（信息与计算科学）((请选择@^**24d%文强（财务管理）((请选择@^**24e%理强（生物学）((请选择@^**24f%文强（社会学）((请选择@^**24g%文强（心理学）((请选择@^**24h%文强（汉语言文学）((请选择@^**24i%文强（金融工程）((请选择@^**24j%生物科学(生物化学与分子生物学方向)((请选择@^**24k%物理学（生物物理学方向）((请选择@^||25_软件学院{{请选择专业@((请选择@**250%软件学类((请选择@^**251%软件工程((请选择@^||26_教育研究院{{请选择专业@((请选择@**261%教育技术学((请选择@^||27_工程管理学院{{请选择专业@((请选择@**270%管理科学与工程类((请选择@^**271%自动化((请选择@^**272%工业工程((请选择@^**273%金融工程((请选择@^**274%信息工程((请选择@^**275%金融工程（计算机与金融工程方向）((请选择@^**277%工业工程类((请选择@^**278%自动化类((请选择@^**279%电气信息类((请选择@^||28_海外教育学院{{请选择专业@((请选择@**280%海外教育类((请选择@^**281%对外汉语((请选择@^**282%汉语言((请选择@^**283%汉语国际教育((请选择@^**286%交流生语言基础课((请选择@^||29_建筑与城市规划学院{{请选择专业@((请选择@**291%建筑学((请选择@^**292%城市规划((请选择@^**293%城乡规划((请选择@^**29A%建筑基地((请选择@^||81_*文科试验班（人文艺术传播类）{{请选择专业@((请选择@**811%*人文艺术传播类((请选择@^||82_*社会科学试验班{{请选择专业@((请选择@**821%*社会科学试验班((请选择@^||83_*理科试验班（地球科学与资源环境类）{{请选择专业@((请选择@**831%*地球科学与资源环境类((请选择@^||84_*理科试验班（数理科学类）{{请选择专业@((请选择@**841%*数理科学类((请选择@^||85_*理科试验班（化学与生命科学类）{{请选择专业@((请选择@**851%*化学与生命科学类((请选择@^||86_*计算机科学与技术类{{请选择专业@((请选择@**861%*计算机科学与技术类((请选择@^||87_*工科试验班{{请选择专业@((请选择@**871%*工科试验班((请选择@^||88_*理科试验班类（大理科班）{{请选择专业@((请选择@**881%*大理科班((请选择@^||89_*经济管理试验班{{请选择专业@((请选择@**891%*经济管理试验班((请选择@^||A4_*外国语言文学类{{请选择专业@((请选择@**A41%*外国语言文学类((请选择@^||A9_*电子信息科学与技术{{请选择专业@((请选择@**A91%*电子信息科学与技术((请选择@^||AA_*软件工程类{{请选择专业@((请选择@**AA1%*软件工程类((请选择@^||AC_*临床医学{{请选择专业@((请选择@**AC1%*临床医学((请选择@^||AD_*临床医学类{{请选择专业@((请选择@**AD1%*临床医学类((请选择@^')
  print(items)#['010', '020', '030', '040', '050', '060', '070', '080', '090', '100', '110', '120', '130', '140', '150', '160', '170', '180', '190', '200', '210', '220', '230', '241', '250', '261', '270', '280', '291', '811', '821', '831', '841', '851', '861', '871', '881', '891', 'A41', 'A91', 'AA1', 'AC1', 'AD1']

def main():
  url = 'http://elite.nju.edu.cn/jiaowu/student/teachinginfo/allCourseList.do?method=getTermAcademy'
  html = get_one_page(url)
  parse_one_page(html)

if __name__ == '__main__':
  main()